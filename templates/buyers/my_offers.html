<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Offers</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/buyer/buyer_offers_style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <script src="{% static 'js/offer_filter.js' %}"></script>
</head>
<body>
    {% include "_navigation.html" %}
    <div class="content-wrapper">
        <div class="page-container">
            <div class="search-container">

                <input type="search" id="search-value" name="search" placeholder="Enter an address, City, Zip or Neighborhood">

                <button type="button" id="apply-filters" class="search-button"><i class="fa-solid fa-magnifying-glass"></i></button>

                <div class="status-filter">
                    <select id="status-filter" name="status">
                            <option value="">Status</option>
                            <option value="ANY">Any</option>
                            <option value="ACCEPTED">Accepted</option>
                            <option value="PENDING">Pending</option>
                            <option value="CONTINGENT">Contingent</option>
                            <option value="REJECTED">Rejected</option>
                    </select>
                </div>
            </div>
            
            {% for msg in messages %}
                {{ msg }}
            {% endfor %}

            <div class="my-offer-grid" id="offer-listed">
                {% if offers %}
                    {% for offer in offers %}
                    <div class="property-card">
                        <div class="property-content">
                            <img src="/static/{{ offer.thumbnail }}" alt="Property image">
                            <div class="property-details">
                                <a href="/catalogue/{{offer.listing_id}}"> <strong>{{offer.street}} {{offer.house_numb}}, {{offer.zip}} {{offer.city}}, {{offer.type}}</strong></a>

                                <div class="seller">
                                    <label for="seller-card">Seller: </label>
                                    <div class="seller-card">
                                        <img src="/static/{{ offer.seller_profile_image_url }}" alt="Seller image">
                                        <div class="seller-info">
                                            <p class="seller-name">{{offer.seller}}, {{offer.seller_type}} </p>
                                            <a href="/sellers/{{offer.seller_id}}/"> See more </a>
                                        </div>
                                    </div>
                                </div>

                                <p>Date of submission: {{offer.submission_date}}</p>
                                <p>Expiration date: {{offer.expiration_date}}</p>
                                <p>Purchase offer price: {{offer.price}}$</p>

                                {% if offer.status == "REJECTED" %}
                                    <p>Offer status: <span class="status rejected">{{offer.status}}</span></p>
                                {% elif offer.status == "ACCEPTED" %}
                                    <p>Offer status: <span class="status accepted">{{offer.status}}</span></p>
                                {% elif offer.status == "CONTINGENT" %}
                                    <p>Offer status: <span class="status contingent">{{offer.status}}</span></p>
                                {% else %}
                                    <p>Offer status: <span class="status pending">{{offer.status}}</span></p>
                                {% endif %}
                            </div>
                        </div>

                        <div class="buttons">

                            <button type="button" onclick = "redirectToDelete( '{{offer.id}}' )" >Delete offer</button>
                            <button type="button"  onclick = "redirectToUpdate( '{{offer.id}}' )">Edit offer</button>
                             <button type="button" onclick = "redirectToFinalization()" >Finalize offer</button>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p> No offers for display</p>
                {% endif %}
            </div>

        </div>
    </div>


    {% include "_footer.html" %}

    <script>
        function redirectToFinalization() {
            // Redirecting directly to the buyer's interface (e.g., catalogue page) without checking login credentials
            window.location.href = "{% url 'finalization' %}";
        }
        function redirectToDelete(offerID) {
            window.location.href = `/offers/delete_offer/${offerID}`;
        }

        function redirectToUpdate(offerID) {
            window.location.href = `/offers/update_offer/${offerID}`;
        }
        //document.querySelector('.ToFinalizeOffer-button').addEventListener('click', function () {
        //    window.location.href = "{% url 'finalization' %}";
        //});
        //document.querySelector('.DeleteOffer-button').addEventListener('click', function () {
        //    window.location.href = `/offers/delete_offer/${this.dataset.id}`;
        //
        //});
    </script>

</body>
</html>